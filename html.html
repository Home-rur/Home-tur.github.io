<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Интерактивный 3D тур по зданию с возможностью просмотра помещений">
    <title>3D Тур по зданию | Виртуальная экскурсия</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --hotspot-color: #ea4335;
            --background-dark: #222;
            --text-light: #f5f5f5;
            --transition-speed: 0.3s;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: var(--background-dark);
            color: var(--text-light);
        }
        
        .panel {
            position: relative;
            overflow: hidden;
        }
        
        .left-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .view-section {
            height: 50%;
            position: relative;
            overflow: hidden;
            transition: opacity var(--transition-speed) ease;
        }
        
        .view-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .view-image:hover {
            transform: scale(1.02);
        }
        
        .right-panel {
            width: 50%;
            position: relative;
            background-color: #000;
        }
        
        .control-panel {
            position: absolute;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            gap: 8px;
            backdrop-filter: blur(5px);
        }
        
        .view-toggle {
            top: 10px;
            left: 10px;
        }
        
        .mode-toggle {
            top: 10px;
            right: 10px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-weight: 500;
        }
        
        button:hover, button:focus {
            background: var(--primary-color);
            outline: none;
        }
        
        button.active {
            background: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.5);
        }
        
        .hotspot {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--hotspot-color);
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 2px solid white;
            transition: transform var(--transition-speed) ease;
        }
        
        .hotspot:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .hotspot::after {
            content: attr(data-room-name);
            position: absolute;
            white-space: nowrap;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
            pointer-events: none;
            font-size: 14px;
        }
        
        .hotspot::before {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(234, 67, 53, 0.3);
            border-radius: 50%;
            top: -8px;
            left: -8px;
            animation: pulse 2s infinite;
        }
        
        .hotspot:hover::after {
            opacity: 1;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            70% { transform: scale(1.3); opacity: 0.2; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
        
        .content-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .photo-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            opacity: 0;
            transition: opacity 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .photo-container.active {
            opacity: 1;
            z-index: 2;
        }
        
        .photo-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }
        
        .panorama-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .panorama-container.active {
            opacity: 1;
            z-index: 2;
        }
        
        .panorama-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 10;
            display: none;
        }
        
        .room-title {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 24px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }
        
        .content-container:hover .room-title {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                width: 100%;
                height: 50%;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <div class="left-panel">
        <div class="control-panel view-toggle">
            <button id="exterior-view" class="active">Вид снаружи</button>
            <button id="interior-view">Вид внутри</button>
        </div>
        
        <div class="view-section top-view">
            <img id="top-exterior" class="view-image" src="exterior_top.jpg" alt="Вид сверху здания снаружи" loading="lazy">
            <img id="top-interior" class="view-image" src="interior_top.jpg" alt="Вид сверху здания изнутри" loading="lazy" style="display: none;">
            
            <!-- Горячие точки для верхней части -->
            <div class="hotspot" style="top: 30%; left: 40%;" data-room="living_room" data-room-name="Гостиная" tabindex="0" aria-label="Перейти в гостиную"></div>
            <div class="hotspot" style="top: 60%; left: 70%;" data-room="kitchen" data-room-name="Кухня" tabindex="0" aria-label="Перейти на кухню"></div>
        </div>
        
        <div class="view-section bottom-view">
            <img id="bottom-exterior" class="view-image" src="exterior_bottom.jpg" alt="Вид снизу здания снаружи" loading="lazy">
            <img id="bottom-interior" class="view-image" src="Разрез1.png" alt="Вид снизу здания изнутри" loading="lazy" style="display: none;">
            
            <!-- Горячие точки для нижней части -->
            <div class="hotspot" style="top: 40%; left: 60%;" data-room="bedroom" data-room-name="Спальня" tabindex="0" aria-label="Перейти в спальню"></div>
            <div class="hotspot" style="top: 70%; left: 30%;" data-room="bathroom" data-room-name="Ванная" tabindex="0" aria-label="Перейти в ванную"></div>
        </div>
    </div>
    
    <div class="right-panel">
        <div class="control-panel mode-toggle">
            <button id="photo-mode" class="active">Фотография</button>
            <button id="tour-mode">Тур</button>
        </div>
        
        <div class="content-container">
            <div class="loading-indicator" id="loading-indicator">Загрузка...</div>
            
            <div class="photo-container active" id="photo-container">
                <img id="room-photo" src="" alt="">
                <div class="room-title" id="room-title"></div>
            </div>
            
            <div class="panorama-container" id="panorama-container">
                <iframe class="panorama-iframe" id="panorama-iframe" allowfullscreen></iframe>
                <div class="room-title" id="panorama-title"></div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const elements = {
                viewButtons: {
                    exterior: document.getElementById('exterior-view'),
                    interior: document.getElementById('interior-view')
                },
                modeButtons: {
                    photo: document.getElementById('photo-mode'),
                    tour: document.getElementById('tour-mode')
                },
                views: {
                    topExterior: document.getElementById('top-exterior'),
                    topInterior: document.getElementById('top-interior'),
                    bottomExterior: document.getElementById('bottom-exterior'),
                    bottomInterior: document.getElementById('bottom-interior')
                },
                content: {
                    photoContainer: document.getElementById('photo-container'),
                    panoramaContainer: document.getElementById('panorama-container'),
                    roomPhoto: document.getElementById('room-photo'),
                    panoramaIframe: document.getElementById('panorama-iframe'),
                    loadingIndicator: document.getElementById('loading-indicator'),
                    roomTitle: document.getElementById('room-title'),
                    panoramaTitle: document.getElementById('panorama-title')
                },
                hotspots: document.querySelectorAll('.hotspot')
            };

            // Состояние приложения
            const state = {
                currentView: 'exterior',
                currentMode: 'photo',
                currentRoom: null,
                roomData: {
                    living_room: {
                        name: 'Гостиная',
                        photo: 'living_room_photo.jpg',
                        panorama: 'living_room_panorama.html'
                    },
                    kitchen: {
                        name: 'Кухня',
                        photo: 'kitchen_photo.jpg',
                        panorama: 'kitchen_panorama.html'
                    },
                    bedroom: {
                        name: 'Спальня',
                        photo: 'bedroom_photo.jpg',
                        panorama: 'bedroom_panorama.html'
                    },
                    bathroom: {
                        name: 'Ванная комната',
                        photo: 'bathroom_photo.jpg',
                        panorama: 'bathroom_panorama.html'
                    }
                }
            };

            // Инициализация
            function init() {
                setupEventListeners();
                parseUrlParameters();
                setInitialView();
            }

            // Настройка обработчиков событий
            function setupEventListeners() {
                // Кнопки переключения вида
                elements.viewButtons.exterior.addEventListener('click', () => setView('exterior'));
                elements.viewButtons.interior.addEventListener('click', () => setView('interior'));

                // Кнопки переключения режима
                elements.modeButtons.photo.addEventListener('click', () => setMode('photo'));
                elements.modeButtons.tour.addEventListener('click', () => setMode('tour'));

                // Горячие точки
                elements.hotspots.forEach(hotspot => {
                    hotspot.addEventListener('click', handleHotspotClick);
                    hotspot.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            handleHotspotClick(e);
                        }
                    });
                });

                // Предзагрузка ресурсов при наведении
                elements.hotspots.forEach(hotspot => {
                    const room = hotspot.dataset.room;
                    hotspot.addEventListener('mouseenter', () => preloadRoomResources(room));
                });
            }

            // Установка начального вида
            function setInitialView() {
                setView(state.currentView);
                setMode(state.currentMode);
                
                // Скрываем горячие точки в режиме exterior
                toggleHotspots(state.currentView === 'interior');
            }

            // Переключение вида (exterior/interior)
            function setView(viewType) {
                if (state.currentView === viewType) return;
                
                state.currentView = viewType;
                
                // Обновление UI
                elements.viewButtons.exterior.classList.toggle('active', viewType === 'exterior');
                elements.viewButtons.interior.classList.toggle('active', viewType === 'interior');
                
                // Показываем соответствующие изображения
                elements.views.topExterior.style.display = viewType === 'exterior' ? 'block' : 'none';
                elements.views.topInterior.style.display = viewType === 'exterior' ? 'none' : 'block';
                elements.views.bottomExterior.style.display = viewType === 'exterior' ? 'block' : 'none';
                elements.views.bottomInterior.style.display = viewType === 'exterior' ? 'none' : 'block';
                
                // Управление видимостью горячих точек
                toggleHotspots(viewType === 'interior');
                
                // Обновление истории браузера
                updateBrowserHistory();
            }

            // Переключение режима (photo/tour)
            function setMode(modeType) {
                if (state.currentMode === modeType) return;
                
                state.currentMode = modeType;
                
                // Обновление UI
                elements.modeButtons.photo.classList.toggle('active', modeType === 'photo');
                elements.modeButtons.tour.classList.toggle('active', modeType === 'tour');
                
                // Показываем соответствующий контейнер
                elements.content.photoContainer.classList.toggle('active', modeType === 'photo');
                elements.content.panoramaContainer.classList.toggle('active', modeType === 'tour');
                
                // Обновление истории браузера
                updateBrowserHistory();
            }

            // Обработка клика по горячей точке
            function handleHotspotClick(event) {
                const hotspot = event.currentTarget;
                const roomId = hotspot.dataset.room;
                
                loadRoom(roomId);
            }

            // Загрузка комнаты
            function loadRoom(roomId) {
                if (!state.roomData[roomId]) return;
                
                state.currentRoom = roomId;
                const room = state.roomData[roomId];
                
                showLoadingIndicator(true);
                
                // Загрузка фото
                loadImage(room.photo).then(() => {
                    elements.content.roomPhoto.src = room.photo;
                    elements.content.roomPhoto.alt = `Фотография ${room.name}`;
                    elements.content.roomTitle.textContent = room.name;
                    
                    // Загрузка панорамы
                    elements.content.panoramaIframe.src = room.panorama;
                    elements.content.panoramaTitle.textContent = room.name;
                    
                    // Переключаемся на фото режим
                    setMode('photo');
                    
                    showLoadingIndicator(false);
                    
                    // Обновление истории браузера
                    updateBrowserHistory();
                }).catch(error => {
                    console.error('Ошибка загрузки изображения:', error);
                    showLoadingIndicator(false);
                });
            }

            // Предзагрузка ресурсов комнаты
            function preloadRoomResources(roomId) {
                if (!state.roomData[roomId]) return;
                
                const room = state.roomData[roomId];
                
                // Предзагрузка изображения
                const img = new Image();
                img.src = room.photo;
                
                // Предзагрузка панорамы (если нужно)
                // Можно добавить предзагрузку iframe или других ресурсов
            }

            // Показать/скрыть индикатор загрузки
            function showLoadingIndicator(show) {
                elements.content.loadingIndicator.style.display = show ? 'block' : 'none';
            }

            // Загрузка изображения с Promise
            function loadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            }

            // Управление видимостью горячих точек
            function toggleHotspots(show) {
                elements.hotspots.forEach(hotspot => {
                    hotspot.style.display = show ? 'block' : 'none';
                    hotspot.tabIndex = show ? 0 : -1;
                });
            }

            // Парсинг параметров URL
            function parseUrlParameters() {
                const params = new URLSearchParams(window.location.search);
                
                // Вид (exterior/interior)
                if (params.has('view')) {
                    const view = params.get('view');
                    if (view === 'interior') {
                        state.currentView = 'interior';
                    }
                }
                
                // Режим (photo/tour)
                if (params.has('mode')) {
                    const mode = params.get('mode');
                    if (mode === 'tour') {
                        state.currentMode = 'tour';
                    }
                }
                
                // Комната
                if (params.has('room') && state.roomData[params.get('room')]) {
                    const roomId = params.get('room');
                    state.currentRoom = roomId;
                    loadRoom(roomId);
                }
            }

            // Обновление истории браузера
            function updateBrowserHistory() {
                const params = new URLSearchParams();
                
                params.set('view', state.currentView);
                params.set('mode', state.currentMode);
                
                if (state.currentRoom) {
                    params.set('room', state.currentRoom);
                }
                
                const newUrl = `${window.location.pathname}?${params.toString()}`;
                window.history.pushState(null, '', newUrl);
            }

            // Обработчик изменения истории (для кнопок назад/вперед)
            window.addEventListener('popstate', () => {
                parseUrlParameters();
                setView(state.currentView);
                setMode(state.currentMode);
                
                if (state.currentRoom) {
                    loadRoom(state.currentRoom);
                }
            });

            // Инициализация приложения
            init();
        });
    </script>
</body>
</html>